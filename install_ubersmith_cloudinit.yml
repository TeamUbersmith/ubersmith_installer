---

  - hosts: local
    any_errors_fatal: true

    pre_tasks:

      - name: Gather all facts of cloud init
        community.general.cloud_init_data_facts:
        register: cloudinit_facts

    vars:
      ubersmith_home: "/usr/local/ubersmith"
      virtual_host: "{{ inventory_hostname }}"
      lets_encrypt_certificate: "yes"
      admin_email: "{{ cloudinit_facts.FIXME}}"
      interactive: false
      certificate_domains: "{{ virtual_host }}"
      notify_email: "{{ admin_email }}"

    roles:
      - common
      - ubersmith